#!/usr/bin/expect -f

set timeout 20
set ip "91.99.232.126"
set user "root"
set password "LpXqTEPurwUu"

spawn ssh -o StrictHostKeyChecking=no $user@$ip

expect {
    "password:" {
        send "$password\r"
        exp_continue
    }
    "# " {
    }
}

send "cd /var/www/whatsapp-bot-builder/products/ai-whatsapp-bot-builder/frontend\r"
expect "# "

send "cat > scripts/test_pdfjs_esm.mjs << 'EOF'\n"
send "import * as pdfjs from 'pdfjs-dist/legacy/build/pdf.mjs';\n"
send "try {\n"
send "  console.log('PDFJS Legacy ESM Loaded');\n"
send "  console.log('Version:', pdfjs.version);\n"
send "} catch (e) {\n"
send "  console.error('Error:', e.message);\n"
send "}\n"
send "EOF\n"
expect "# "

send "node scripts/test_pdfjs_esm.mjs\r"
expect "# "

send "rm scripts/test_pdfjs_esm.mjs\r"
expect "# "

send "exit\r"
expect eof
